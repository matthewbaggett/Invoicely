<?php
global $user;
$available_financial_years_results = db_query("
  SELECT
    financial_year
  FROM
    invoicely_get_financial_years_available
  WHERE
    uid = {$user->uid}
");
$available_financial_years = array();
foreach($available_financial_years_results as $available_financial_year){
  $available_financial_years[] = $available_financial_year->financial_year;
}
foreach($available_financial_years as $available_financial_year){
  $year_invoice_total_results = active_record_dumb_model::queryOne("
    SELECT
      SUM(amount_paid_cumulative) as amount_paid_cumulative,
      financial_year
    FROM
      invoicely_invoice_view_monthly_totals
    WHERE
      financial_year = '{$available_financial_year}'
      AND uid = {$user->uid}
    GROUP BY financial_year
  ");

  $year_mileage_total_results = active_record_dumb_model::queryOne("
    SELECT
      financial_year,
      distance,
      amount as mileage_allowance
    FROM
      invoicely_mileage_view_yearly_amounts
    WHERE
      financial_year = '{$available_financial_year}'
      AND uid = {$user->uid}
  ");

  $year_receipts_total_results = active_record_dumb_model::queryOne("
    SELECT
      financial_year,
      amount_cumulative
    FROM
      invoicely_reciept_view_yearly_totals
    WHERE
      financial_year = '{$available_financial_year}'
      AND uid = {$user->uid}
  ");

  $tax_liability = 0;

  krumo($year_invoice_total_results, $year_mileage_total_results, $year_receipts_total_results)
  ?>
  <div class="widget">
    <h3><?php echo t("Liability for year :year", array(':year' => $available_financial_year)); ?></h3>
    <dl>

    </dl>
  </div>

<?php } ?>